"""core.py

Provides a container class for TREAT core lattice

"""

import common_files.treat.constants as c
from common_files.treat.corebuilder import TemplatedLattice
import openmc

# Set some parameters for the positioning of each of the excore graphite permanent reflector movable blocks
# These are set here in the local directory so that each full core model can have the reflector holes either open or closed
# as needed.
# The parameter for each hole will be a fraction ranging from 0 (fully closed) to 1 (fully open)
excorePermReflNHolePosition = 1.00
excorePermReflWHolePosition = 1.00
excorePermReflSHolePosition = 1.00

class Core(object):

  #################################################################################################################################################
  # The core lattice template list contains all of the spots in the core grid. This provides the shape of the lattice to corebuilder, and
  # should always be completely full
  core_lattice_template = [
    ['A___1', 'B___1', 'C___1', 'D___1', 'E___1', 'F___1', 'G___1', 'H___1', 'J___1', 'K___1', 'L___1', 'M___1', 'N___1', 'O___1', 'P___1', 'R___1', 'S___1', 'T___1', 'U___1'],
    ['A___2', 'B___2', 'C___2', 'D___2', 'E___2', 'F___2', 'G___2', 'H___2', 'J___2', 'K___2', 'L___2', 'M___2', 'N___2', 'O___2', 'P___2', 'R___2', 'S___2', 'T___2', 'U___2'],
    ['A___3', 'B___3', 'C___3', 'D___3', 'E___3', 'F___3', 'G___3', 'H___3', 'J___3', 'K___3', 'L___3', 'M___3', 'N___3', 'O___3', 'P___3', 'R___3', 'S___3', 'T___3', 'U___3'],
    ['A___4', 'B___4', 'C___4', 'D___4', 'E___4', 'F___4', 'G___4', 'H___4', 'J___4', 'K___4', 'L___4', 'M___4', 'N___4', 'O___4', 'P___4', 'R___4', 'S___4', 'T___4', 'U___4'],
    ['A___5', 'B___5', 'C___5', 'D___5', 'E___5', 'F___5', 'G___5', 'H___5', 'J___5', 'K___5', 'L___5', 'M___5', 'N___5', 'O___5', 'P___5', 'R___5', 'S___5', 'T___5', 'U___5'],
    ['A___6', 'B___6', 'C___6', 'D___6', 'E___6', 'F___6', 'G___6', 'H___6', 'J___6', 'K___6', 'L___6', 'M___6', 'N___6', 'O___6', 'P___6', 'R___6', 'S___6', 'T___6', 'U___6'],
    ['A___7', 'B___7', 'C___7', 'D___7', 'E___7', 'F___7', 'G___7', 'H___7', 'J___7', 'K___7', 'L___7', 'M___7', 'N___7', 'O___7', 'P___7', 'R___7', 'S___7', 'T___7', 'U___7'],
    ['A___8', 'B___8', 'C___8', 'D___8', 'E___8', 'F___8', 'G___8', 'H___8', 'J___8', 'K___8', 'L___8', 'M___8', 'N___8', 'O___8', 'P___8', 'R___8', 'S___8', 'T___8', 'U___8'],
    ['A___9', 'B___9', 'C___9', 'D___9', 'E___9', 'F___9', 'G___9', 'H___9', 'J___9', 'K___9', 'L___9', 'M___9', 'N___9', 'O___9', 'P___9', 'R___9', 'S___9', 'T___9', 'U___9'],
    ['A__10', 'B__10', 'C__10', 'D__10', 'E__10', 'F__10', 'G__10', 'H__10', 'J__10', 'K__10', 'L__10', 'M__10', 'N__10', 'O__10', 'P__10', 'R__10', 'S__10', 'T__10', 'U__10'],
    ['A__11', 'B__11', 'C__11', 'D__11', 'E__11', 'F__11', 'G__11', 'H__11', 'J__11', 'K__11', 'L__11', 'M__11', 'N__11', 'O__11', 'P__11', 'R__11', 'S__11', 'T__11', 'U__11'],
    ['A__12', 'B__12', 'C__12', 'D__12', 'E__12', 'F__12', 'G__12', 'H__12', 'J__12', 'K__12', 'L__12', 'M__12', 'N__12', 'O__12', 'P__12', 'R__12', 'S__12', 'T__12', 'U__12'],
    ['A__13', 'B__13', 'C__13', 'D__13', 'E__13', 'F__13', 'G__13', 'H__13', 'J__13', 'K__13', 'L__13', 'M__13', 'N__13', 'O__13', 'P__13', 'R__13', 'S__13', 'T__13', 'U__13'],
    ['A__14', 'B__14', 'C__14', 'D__14', 'E__14', 'F__14', 'G__14', 'H__14', 'J__14', 'K__14', 'L__14', 'M__14', 'N__14', 'O__14', 'P__14', 'R__14', 'S__14', 'T__14', 'U__14'],
    ['A__15', 'B__15', 'C__15', 'D__15', 'E__15', 'F__15', 'G__15', 'H__15', 'J__15', 'K__15', 'L__15', 'M__15', 'N__15', 'O__15', 'P__15', 'R__15', 'S__15', 'T__15', 'U__15'],
    ['A__16', 'B__16', 'C__16', 'D__16', 'E__16', 'F__16', 'G__16', 'H__16', 'J__16', 'K__16', 'L__16', 'M__16', 'N__16', 'O__16', 'P__16', 'R__16', 'S__16', 'T__16', 'U__16'],
    ['A__17', 'B__17', 'C__17', 'D__17', 'E__17', 'F__17', 'G__17', 'H__17', 'J__17', 'K__17', 'L__17', 'M__17', 'N__17', 'O__17', 'P__17', 'R__17', 'S__17', 'T__17', 'U__17'],
    ['A__18', 'B__18', 'C__18', 'D__18', 'E__18', 'F__18', 'G__18', 'H__18', 'J__18', 'K__18', 'L__18', 'M__18', 'N__18', 'O__18', 'P__18', 'R__18', 'S__18', 'T__18', 'U__18'],
    ['A__19', 'B__19', 'C__19', 'D__19', 'E__19', 'F__19', 'G__19', 'H__19', 'J__19', 'K__19', 'L__19', 'M__19', 'N__19', 'O__19', 'P__19', 'R__19', 'S__19', 'T__19', 'U__19'],
  ]

  # Positions that have standard elements we wish to autofill from the elements file. In most cases, this will look very similar to the 
  # core_lattice_template, but as a single list instead of an ordered lattice. Element locations would be left empty here if there was a 
  # lattice position that we did not want to autofill (e.g. a gap with pure air from an assembly being left out, or an experimental test position)
  core_positions = [
    'A___1', 'B___1', 'C___1', 'D___1', 'E___1', 'F___1', 'G___1', 'H___1', 'J___1', 'K___1', 'L___1', 'M___1', 'N___1', 'O___1', 'P___1', 'R___1', 'S___1', 'T___1', 'U___1',
    'A___2', 'B___2', 'C___2', 'D___2', 'E___2', 'F___2', 'G___2', 'H___2', 'J___2', 'K___2', 'L___2', 'M___2', 'N___2', 'O___2', 'P___2', 'R___2', 'S___2', 'T___2', 'U___2',
    'A___3', 'B___3', 'C___3', 'D___3', 'E___3', 'F___3', 'G___3', 'H___3', 'J___3', 'K___3', 'L___3', 'M___3', 'N___3', 'O___3', 'P___3', 'R___3', 'S___3', 'T___3', 'U___3',
    'A___4', 'B___4', 'C___4', 'D___4', 'E___4', 'F___4', 'G___4', 'H___4', 'J___4', 'K___4', 'L___4', 'M___4', 'N___4', 'O___4', 'P___4', 'R___4', 'S___4', 'T___4', 'U___4',
    'A___5', 'B___5', 'C___5', 'D___5', 'E___5', 'F___5', 'G___5', 'H___5', 'J___5', 'K___5', 'L___5', 'M___5', 'N___5', 'O___5', 'P___5', 'R___5', 'S___5', 'T___5', 'U___5',
    'A___6', 'B___6', 'C___6', 'D___6', 'E___6', 'F___6', 'G___6', 'H___6', 'J___6', 'K___6', 'L___6', 'M___6', 'N___6', 'O___6', 'P___6', 'R___6', 'S___6', 'T___6', 'U___6',
    'A___7', 'B___7', 'C___7', 'D___7', 'E___7', 'F___7', 'G___7', 'H___7', 'J___7', 'K___7', 'L___7', 'M___7', 'N___7', 'O___7', 'P___7', 'R___7', 'S___7', 'T___7', 'U___7',
    'A___8', 'B___8', 'C___8', 'D___8', 'E___8', 'F___8', 'G___8', 'H___8', 'J___8', 'K___8', 'L___8', 'M___8', 'N___8', 'O___8', 'P___8', 'R___8', 'S___8', 'T___8', 'U___8',
    'A___9', 'B___9', 'C___9', 'D___9', 'E___9', 'F___9', 'G___9', 'H___9', 'J___9',          'L___9', 'M___9', 'N___9', 'O___9', 'P___9', 'R___9', 'S___9', 'T___9', 'U___9',
    'A__10', 'B__10', 'C__10', 'D__10', 'E__10', 'F__10', 'G__10', 'H__10', 'J__10',          'L__10', 'M__10', 'N__10', 'O__10', 'P__10', 'R__10', 'S__10', 'T__10', 'U__10',
    'A__11', 'B__11', 'C__11', 'D__11', 'E__11', 'F__11', 'G__11', 'H__11', 'J__11',          'L__11', 'M__11', 'N__11', 'O__11', 'P__11', 'R__11', 'S__11', 'T__11', 'U__11',
    'A__12', 'B__12', 'C__12', 'D__12', 'E__12', 'F__12', 'G__12', 'H__12', 'J__12', 'K__12', 'L__12', 'M__12', 'N__12', 'O__12', 'P__12', 'R__12', 'S__12', 'T__12', 'U__12',
    'A__13', 'B__13', 'C__13', 'D__13', 'E__13', 'F__13', 'G__13', 'H__13', 'J__13', 'K__13', 'L__13', 'M__13', 'N__13', 'O__13', 'P__13', 'R__13', 'S__13', 'T__13', 'U__13',
    'A__14', 'B__14', 'C__14', 'D__14', 'E__14', 'F__14', 'G__14', 'H__14', 'J__14', 'K__14', 'L__14', 'M__14', 'N__14', 'O__14', 'P__14', 'R__14', 'S__14', 'T__14', 'U__14',
    'A__15', 'B__15', 'C__15', 'D__15', 'E__15', 'F__15', 'G__15', 'H__15', 'J__15', 'K__15', 'L__15', 'M__15', 'N__15', 'O__15', 'P__15', 'R__15', 'S__15', 'T__15', 'U__15',
    'A__16', 'B__16', 'C__16', 'D__16', 'E__16', 'F__16', 'G__16', 'H__16', 'J__16', 'K__16', 'L__16', 'M__16', 'N__16', 'O__16', 'P__16', 'R__16', 'S__16', 'T__16', 'U__16',
    'A__17', 'B__17', 'C__17', 'D__17', 'E__17', 'F__17', 'G__17', 'H__17', 'J__17', 'K__17', 'L__17', 'M__17', 'N__17', 'O__17', 'P__17', 'R__17', 'S__17', 'T__17', 'U__17',
    'A__18', 'B__18', 'C__18', 'D__18', 'E__18', 'F__18', 'G__18', 'H__18', 'J__18', 'K__18', 'L__18', 'M__18', 'N__18', 'O__18', 'P__18', 'R__18', 'S__18', 'T__18', 'U__18',
    'A__19', 'B__19', 'C__19', 'D__19', 'E__19', 'F__19', 'G__19', 'H__19', 'J__19', 'K__19', 'L__19', 'M__19', 'N__19', 'O__19', 'P__19', 'R__19', 'S__19', 'T__19', 'U__19'
  ]
  #################################################################################################################################################

  def __init__(self, elements, vessel, has_experiment=True):
    """ Creates TREAT core lattice universe """
    
    self.elements = elements
    self.vessel = vessel
    self.has_experiment = has_experiment

    self.NBlockPos = excorePermReflNHolePosition
    self.WBlockPos = excorePermReflWHolePosition
    self.SBlockPos = excorePermReflSHolePosition

    self._set_weight_percent_positions()
    self._set_boron_ppm_positions()
    self._set_cladding_positions()
    self._set_slot_positions()
    self._set_rcca_positions()
    self._make_core_universe()
    
  def _set_weight_percent_positions(self):
    """ Sets the specification for TREAT assembly fuel weight percent positions """
    
  #################################################################################################################################################
  # Sets the fuel weight percent in each autofilled element position. At the moment, 0.211% is the only option.
    self.fuel_wgt_positions ={
                                        'C___1':'0.211%', 'D___1':'0.211%', 'E___1':'0.211%', 'F___1':'0.211%', 'G___1':'0.211%', 'H___1':'0.211%', 'J___1':'0.211%',                   'L___1':'0.211%', 'M___1':'0.211%', 'N___1':'0.211%', 'O___1':'0.211%', 'P___1':'0.211%', 'R___1':'0.211%', 'S___1':'0.211%',                                    
                      'B___2':'0.211%', 'C___2':'0.211%', 'D___2':'0.211%', 'E___2':'0.211%', 'F___2':'0.211%', 'G___2':'0.211%', 'H___2':'0.211%', 'J___2':'0.211%',                   'L___2':'0.211%', 'M___2':'0.211%', 'N___2':'0.211%', 'O___2':'0.211%', 'P___2':'0.211%', 'R___2':'0.211%', 'S___2':'0.211%', 'T___2':'0.211%',                  
    'A___3':'0.211%', 'B___3':'0.211%', 'C___3':'0.211%', 'D___3':'0.211%', 'E___3':'0.211%', 'F___3':'0.211%', 'G___3':'0.211%', 'H___3':'0.211%', 'J___3':'0.211%',                   'L___3':'0.211%', 'M___3':'0.211%', 'N___3':'0.211%', 'O___3':'0.211%', 'P___3':'0.211%', 'R___3':'0.211%', 'S___3':'0.211%', 'T___3':'0.211%', 'U___3':'0.211%',
    'A___4':'0.211%', 'B___4':'0.211%', 'C___4':'0.211%', 'D___4':'0.211%', 'E___4':'0.211%', 'F___4':'0.211%', 'G___4':'0.211%', 'H___4':'0.211%', 'J___4':'0.211%',                   'L___4':'0.211%', 'M___4':'0.211%', 'N___4':'0.211%', 'O___4':'0.211%', 'P___4':'0.211%', 'R___4':'0.211%', 'S___4':'0.211%', 'T___4':'0.211%', 'U___4':'0.211%',
    'A___5':'0.211%', 'B___5':'0.211%', 'C___5':'0.211%', 'D___5':'0.211%', 'E___5':'0.211%', 'F___5':'0.211%', 'G___5':'0.211%', 'H___5':'0.211%', 'J___5':'0.211%',                   'L___5':'0.211%', 'M___5':'0.211%', 'N___5':'0.211%', 'O___5':'0.211%', 'P___5':'0.211%', 'R___5':'0.211%', 'S___5':'0.211%', 'T___5':'0.211%', 'U___5':'0.211%',
    'A___6':'0.211%', 'B___6':'0.211%', 'C___6':'0.211%', 'D___6':'0.211%', 'E___6':'0.211%', 'F___6':'0.211%', 'G___6':'0.211%', 'H___6':'0.211%', 'J___6':'0.211%',                   'L___6':'0.211%', 'M___6':'0.211%', 'N___6':'0.211%', 'O___6':'0.211%', 'P___6':'0.211%', 'R___6':'0.211%', 'S___6':'0.211%', 'T___6':'0.211%', 'U___6':'0.211%',
    'A___7':'0.211%', 'B___7':'0.211%', 'C___7':'0.211%', 'D___7':'0.211%', 'E___7':'0.211%', 'F___7':'0.211%', 'G___7':'0.211%', 'H___7':'0.211%', 'J___7':'0.211%',                   'L___7':'0.211%', 'M___7':'0.211%', 'N___7':'0.211%', 'O___7':'0.211%', 'P___7':'0.211%', 'R___7':'0.211%', 'S___7':'0.211%', 'T___7':'0.211%', 'U___7':'0.211%',
    'A___8':'0.211%', 'B___8':'0.211%', 'C___8':'0.211%', 'D___8':'0.211%', 'E___8':'0.211%', 'F___8':'0.211%', 'G___8':'0.211%', 'H___8':'0.211%', 'J___8':'0.211%',                   'L___8':'0.211%', 'M___8':'0.211%', 'N___8':'0.211%', 'O___8':'0.211%', 'P___8':'0.211%', 'R___8':'0.211%', 'S___8':'0.211%', 'T___8':'0.211%', 'U___8':'0.211%',
    'A___9':'0.211%', 'B___9':'0.211%', 'C___9':'0.211%', 'D___9':'0.211%', 'E___9':'0.211%', 'F___9':'0.211%', 'G___9':'0.211%', 'H___9':'0.211%', 'J___9':'0.211%',                   'L___9':'0.211%', 'M___9':'0.211%', 'N___9':'0.211%', 'O___9':'0.211%', 'P___9':'0.211%', 'R___9':'0.211%', 'S___9':'0.211%', 'T___9':'0.211%', 'U___9':'0.211%',
    'A__10':'0.211%', 'B__10':'0.211%', 'C__10':'0.211%', 'D__10':'0.211%', 'E__10':'0.211%', 'F__10':'0.211%', 'G__10':'0.211%', 'H__10':'0.211%', 'J__10':'0.211%',                   'L__10':'0.211%', 'M__10':'0.211%', 'N__10':'0.211%', 'O__10':'0.211%', 'P__10':'0.211%', 'R__10':'0.211%', 'S__10':'0.211%', 'T__10':'0.211%', 'U__10':'0.211%',
    'A__11':'0.211%', 'B__11':'0.211%', 'C__11':'0.211%', 'D__11':'0.211%', 'E__11':'0.211%', 'F__11':'0.211%', 'G__11':'0.211%', 'H__11':'0.211%', 'J__11':'0.211%',                   'L__11':'0.211%', 'M__11':'0.211%', 'N__11':'0.211%', 'O__11':'0.211%', 'P__11':'0.211%', 'R__11':'0.211%', 'S__11':'0.211%', 'T__11':'0.211%', 'U__11':'0.211%',
    'A__12':'0.211%', 'B__12':'0.211%', 'C__12':'0.211%', 'D__12':'0.211%', 'E__12':'0.211%', 'F__12':'0.211%', 'G__12':'0.211%', 'H__12':'0.211%', 'J__12':'0.211%', 'K__12':'0.211%', 'L__12':'0.211%', 'M__12':'0.211%', 'N__12':'0.211%', 'O__12':'0.211%', 'P__12':'0.211%', 'R__12':'0.211%', 'S__12':'0.211%', 'T__12':'0.211%', 'U__12':'0.211%',
    'A__13':'0.211%', 'B__13':'0.211%', 'C__13':'0.211%', 'D__13':'0.211%', 'E__13':'0.211%', 'F__13':'0.211%', 'G__13':'0.211%', 'H__13':'0.211%', 'J__13':'0.211%', 'K__13':'0.211%', 'L__13':'0.211%', 'M__13':'0.211%', 'N__13':'0.211%', 'O__13':'0.211%', 'P__13':'0.211%', 'R__13':'0.211%', 'S__13':'0.211%', 'T__13':'0.211%', 'U__13':'0.211%',
    'A__14':'0.211%', 'B__14':'0.211%', 'C__14':'0.211%', 'D__14':'0.211%', 'E__14':'0.211%', 'F__14':'0.211%', 'G__14':'0.211%', 'H__14':'0.211%', 'J__14':'0.211%', 'K__14':'0.211%', 'L__14':'0.211%', 'M__14':'0.211%', 'N__14':'0.211%', 'O__14':'0.211%', 'P__14':'0.211%', 'R__14':'0.211%', 'S__14':'0.211%', 'T__14':'0.211%', 'U__14':'0.211%',
    'A__15':'0.211%', 'B__15':'0.211%', 'C__15':'0.211%', 'D__15':'0.211%', 'E__15':'0.211%', 'F__15':'0.211%', 'G__15':'0.211%', 'H__15':'0.211%', 'J__15':'0.211%', 'K__15':'0.211%', 'L__15':'0.211%', 'M__15':'0.211%', 'N__15':'0.211%', 'O__15':'0.211%', 'P__15':'0.211%', 'R__15':'0.211%', 'S__15':'0.211%', 'T__15':'0.211%', 'U__15':'0.211%',
    'A__16':'0.211%', 'B__16':'0.211%', 'C__16':'0.211%', 'D__16':'0.211%', 'E__16':'0.211%', 'F__16':'0.211%', 'G__16':'0.211%', 'H__16':'0.211%', 'J__16':'0.211%', 'K__16':'0.211%', 'L__16':'0.211%', 'M__16':'0.211%', 'N__16':'0.211%', 'O__16':'0.211%', 'P__16':'0.211%', 'R__16':'0.211%', 'S__16':'0.211%', 'T__16':'0.211%', 'U__16':'0.211%',
    'A__17':'0.211%', 'B__17':'0.211%', 'C__17':'0.211%', 'D__17':'0.211%', 'E__17':'0.211%', 'F__17':'0.211%', 'G__17':'0.211%', 'H__17':'0.211%', 'J__17':'0.211%', 'K__17':'0.211%', 'L__17':'0.211%', 'M__17':'0.211%', 'N__17':'0.211%', 'O__17':'0.211%', 'P__17':'0.211%', 'R__17':'0.211%', 'S__17':'0.211%', 'T__17':'0.211%', 'U__17':'0.211%',
                      'B__18':'0.211%', 'C__18':'0.211%', 'D__18':'0.211%', 'E__18':'0.211%', 'F__18':'0.211%', 'G__18':'0.211%', 'H__18':'0.211%', 'J__18':'0.211%', 'K__18':'0.211%', 'L__18':'0.211%', 'M__18':'0.211%', 'N__18':'0.211%', 'O__18':'0.211%', 'P__18':'0.211%', 'R__18':'0.211%', 'S__18':'0.211%', 'T__18':'0.211%',                  
                                        'C__19':'0.211%', 'D__19':'0.211%', 'E__19':'0.211%', 'F__19':'0.211%', 'G__19':'0.211%', 'H__19':'0.211%', 'J__19':'0.211%', 'K__19':'0.211%', 'L__19':'0.211%', 'M__19':'0.211%', 'N__19':'0.211%', 'O__19':'0.211%', 'P__19':'0.211%', 'R__19':'0.211%', 'S__19':'0.211%',                                   
    }
  #################################################################################################################################################

  def _set_boron_ppm_positions(self):
    """ Sets the specification for TREAT assembly boron ppm positions """
    
  #################################################################################################################################################
  # Sets the boron impurity values in the active fuel region in each autofilled element position
    self.fuel_ppm_positions ={
                                          'C___1':'5.9 ppm', 'D___1':'5.9 ppm', 'E___1':'5.9 ppm', 'F___1':'5.9 ppm', 'G___1':'5.9 ppm', 'H___1':'5.9 ppm', 'J___1':'5.9 ppm',                    'L___1':'5.9 ppm', 'M___1':'5.9 ppm', 'N___1':'5.9 ppm', 'O___1':'5.9 ppm', 'P___1':'5.9 ppm', 'R___1':'5.9 ppm', 'S___1':'5.9 ppm',                                    
                       'B___2':'5.9 ppm', 'C___2':'5.9 ppm', 'D___2':'5.9 ppm', 'E___2':'5.9 ppm', 'F___2':'5.9 ppm', 'G___2':'5.9 ppm', 'H___2':'5.9 ppm', 'J___2':'5.9 ppm',                    'L___2':'5.9 ppm', 'M___2':'5.9 ppm', 'N___2':'5.9 ppm', 'O___2':'5.9 ppm', 'P___2':'5.9 ppm', 'R___2':'5.9 ppm', 'S___2':'5.9 ppm', 'T___2':'5.9 ppm',                  
    'A___3':'5.9 ppm', 'B___3':'5.9 ppm', 'C___3':'5.9 ppm', 'D___3':'5.9 ppm', 'E___3':'5.9 ppm', 'F___3':'5.9 ppm', 'G___3':'5.9 ppm', 'H___3':'5.9 ppm', 'J___3':'5.9 ppm',                    'L___3':'5.9 ppm', 'M___3':'5.9 ppm', 'N___3':'5.9 ppm', 'O___3':'5.9 ppm', 'P___3':'5.9 ppm', 'R___3':'5.9 ppm', 'S___3':'5.9 ppm', 'T___3':'5.9 ppm', 'U___3':'5.9 ppm',
    'A___4':'5.9 ppm', 'B___4':'5.9 ppm', 'C___4':'5.9 ppm', 'D___4':'5.9 ppm', 'E___4':'5.9 ppm', 'F___4':'5.9 ppm', 'G___4':'5.9 ppm', 'H___4':'5.9 ppm', 'J___4':'5.9 ppm',                    'L___4':'5.9 ppm', 'M___4':'5.9 ppm', 'N___4':'5.9 ppm', 'O___4':'5.9 ppm', 'P___4':'5.9 ppm', 'R___4':'5.9 ppm', 'S___4':'5.9 ppm', 'T___4':'5.9 ppm', 'U___4':'5.9 ppm',
    'A___5':'5.9 ppm', 'B___5':'5.9 ppm', 'C___5':'5.9 ppm', 'D___5':'5.9 ppm', 'E___5':'5.9 ppm', 'F___5':'5.9 ppm', 'G___5':'5.9 ppm', 'H___5':'5.9 ppm', 'J___5':'5.9 ppm',                    'L___5':'5.9 ppm', 'M___5':'5.9 ppm', 'N___5':'5.9 ppm', 'O___5':'5.9 ppm', 'P___5':'5.9 ppm', 'R___5':'5.9 ppm', 'S___5':'5.9 ppm', 'T___5':'5.9 ppm', 'U___5':'5.9 ppm',
    'A___6':'5.9 ppm', 'B___6':'5.9 ppm', 'C___6':'5.9 ppm', 'D___6':'5.9 ppm', 'E___6':'5.9 ppm', 'F___6':'5.9 ppm', 'G___6':'5.9 ppm', 'H___6':'5.9 ppm', 'J___6':'5.9 ppm',                    'L___6':'5.9 ppm', 'M___6':'5.9 ppm', 'N___6':'5.9 ppm', 'O___6':'5.9 ppm', 'P___6':'5.9 ppm', 'R___6':'5.9 ppm', 'S___6':'5.9 ppm', 'T___6':'5.9 ppm', 'U___6':'5.9 ppm',
    'A___7':'5.9 ppm', 'B___7':'5.9 ppm', 'C___7':'5.9 ppm', 'D___7':'5.9 ppm', 'E___7':'5.9 ppm', 'F___7':'5.9 ppm', 'G___7':'5.9 ppm', 'H___7':'5.9 ppm', 'J___7':'5.9 ppm',                    'L___7':'5.9 ppm', 'M___7':'5.9 ppm', 'N___7':'5.9 ppm', 'O___7':'5.9 ppm', 'P___7':'5.9 ppm', 'R___7':'5.9 ppm', 'S___7':'5.9 ppm', 'T___7':'5.9 ppm', 'U___7':'5.9 ppm',
    'A___8':'5.9 ppm', 'B___8':'5.9 ppm', 'C___8':'5.9 ppm', 'D___8':'5.9 ppm', 'E___8':'5.9 ppm', 'F___8':'5.9 ppm', 'G___8':'5.9 ppm', 'H___8':'5.9 ppm', 'J___8':'5.9 ppm',                    'L___8':'5.9 ppm', 'M___8':'5.9 ppm', 'N___8':'5.9 ppm', 'O___8':'5.9 ppm', 'P___8':'5.9 ppm', 'R___8':'5.9 ppm', 'S___8':'5.9 ppm', 'T___8':'5.9 ppm', 'U___8':'5.9 ppm',
    'A___9':'5.9 ppm', 'B___9':'5.9 ppm', 'C___9':'5.9 ppm', 'D___9':'5.9 ppm', 'E___9':'5.9 ppm', 'F___9':'5.9 ppm', 'G___9':'5.9 ppm', 'H___9':'5.9 ppm', 'J___9':'5.9 ppm',                   'L___9':'5.9 ppm', 'M___9':'5.9 ppm', 'N___9':'5.9 ppm', 'O___9':'5.9 ppm', 'P___9':'5.9 ppm', 'R___9':'5.9 ppm', 'S___9':'5.9 ppm', 'T___9':'5.9 ppm', 'U___9':'5.9 ppm',
    'A__10':'5.9 ppm', 'B__10':'5.9 ppm', 'C__10':'5.9 ppm', 'D__10':'5.9 ppm', 'E__10':'5.9 ppm', 'F__10':'5.9 ppm', 'G__10':'5.9 ppm', 'H__10':'5.9 ppm', 'J__10':'5.9 ppm',                   'L__10':'5.9 ppm', 'M__10':'5.9 ppm', 'N__10':'5.9 ppm', 'O__10':'5.9 ppm', 'P__10':'5.9 ppm', 'R__10':'5.9 ppm', 'S__10':'5.9 ppm', 'T__10':'5.9 ppm', 'U__10':'5.9 ppm',
    'A__11':'5.9 ppm', 'B__11':'5.9 ppm', 'C__11':'5.9 ppm', 'D__11':'5.9 ppm', 'E__11':'5.9 ppm', 'F__11':'5.9 ppm', 'G__11':'5.9 ppm', 'H__11':'5.9 ppm', 'J__11':'5.9 ppm',                   'L__11':'5.9 ppm', 'M__11':'5.9 ppm', 'N__11':'5.9 ppm', 'O__11':'5.9 ppm', 'P__11':'5.9 ppm', 'R__11':'5.9 ppm', 'S__11':'5.9 ppm', 'T__11':'5.9 ppm', 'U__11':'5.9 ppm',
    'A__12':'5.9 ppm', 'B__12':'5.9 ppm', 'C__12':'5.9 ppm', 'D__12':'5.9 ppm', 'E__12':'5.9 ppm', 'F__12':'5.9 ppm', 'G__12':'5.9 ppm', 'H__12':'5.9 ppm', 'J__12':'5.9 ppm', 'K__12':'5.9 ppm', 'L__12':'5.9 ppm', 'M__12':'5.9 ppm', 'N__12':'5.9 ppm', 'O__12':'5.9 ppm', 'P__12':'5.9 ppm', 'R__12':'5.9 ppm', 'S__12':'5.9 ppm', 'T__12':'5.9 ppm', 'U__12':'5.9 ppm',
    'A__13':'5.9 ppm', 'B__13':'5.9 ppm', 'C__13':'5.9 ppm', 'D__13':'5.9 ppm', 'E__13':'5.9 ppm', 'F__13':'5.9 ppm', 'G__13':'5.9 ppm', 'H__13':'5.9 ppm', 'J__13':'5.9 ppm', 'K__13':'5.9 ppm', 'L__13':'5.9 ppm', 'M__13':'5.9 ppm', 'N__13':'5.9 ppm', 'O__13':'5.9 ppm', 'P__13':'5.9 ppm', 'R__13':'5.9 ppm', 'S__13':'5.9 ppm', 'T__13':'5.9 ppm', 'U__13':'5.9 ppm',
    'A__14':'5.9 ppm', 'B__14':'5.9 ppm', 'C__14':'5.9 ppm', 'D__14':'5.9 ppm', 'E__14':'5.9 ppm', 'F__14':'5.9 ppm', 'G__14':'5.9 ppm', 'H__14':'5.9 ppm', 'J__14':'5.9 ppm', 'K__14':'5.9 ppm', 'L__14':'5.9 ppm', 'M__14':'5.9 ppm', 'N__14':'5.9 ppm', 'O__14':'5.9 ppm', 'P__14':'5.9 ppm', 'R__14':'5.9 ppm', 'S__14':'5.9 ppm', 'T__14':'5.9 ppm', 'U__14':'5.9 ppm',
    'A__15':'5.9 ppm', 'B__15':'5.9 ppm', 'C__15':'5.9 ppm', 'D__15':'5.9 ppm', 'E__15':'5.9 ppm', 'F__15':'5.9 ppm', 'G__15':'5.9 ppm', 'H__15':'5.9 ppm', 'J__15':'5.9 ppm', 'K__15':'5.9 ppm', 'L__15':'5.9 ppm', 'M__15':'5.9 ppm', 'N__15':'5.9 ppm', 'O__15':'5.9 ppm', 'P__15':'5.9 ppm', 'R__15':'5.9 ppm', 'S__15':'5.9 ppm', 'T__15':'5.9 ppm', 'U__15':'5.9 ppm',
    'A__16':'5.9 ppm', 'B__16':'5.9 ppm', 'C__16':'5.9 ppm', 'D__16':'5.9 ppm', 'E__16':'5.9 ppm', 'F__16':'5.9 ppm', 'G__16':'5.9 ppm', 'H__16':'5.9 ppm', 'J__16':'5.9 ppm', 'K__16':'5.9 ppm', 'L__16':'5.9 ppm', 'M__16':'5.9 ppm', 'N__16':'5.9 ppm', 'O__16':'5.9 ppm', 'P__16':'5.9 ppm', 'R__16':'5.9 ppm', 'S__16':'5.9 ppm', 'T__16':'5.9 ppm', 'U__16':'5.9 ppm',
    'A__17':'5.9 ppm', 'B__17':'5.9 ppm', 'C__17':'5.9 ppm', 'D__17':'5.9 ppm', 'E__17':'5.9 ppm', 'F__17':'5.9 ppm', 'G__17':'5.9 ppm', 'H__17':'5.9 ppm', 'J__17':'5.9 ppm', 'K__17':'5.9 ppm', 'L__17':'5.9 ppm', 'M__17':'5.9 ppm', 'N__17':'5.9 ppm', 'O__17':'5.9 ppm', 'P__17':'5.9 ppm', 'R__17':'5.9 ppm', 'S__17':'5.9 ppm', 'T__17':'5.9 ppm', 'U__17':'5.9 ppm',
                      'B__18':'5.9 ppm', 'C__18':'5.9 ppm', 'D__18':'5.9 ppm', 'E__18':'5.9 ppm', 'F__18':'5.9 ppm', 'G__18':'5.9 ppm', 'H__18':'5.9 ppm', 'J__18':'5.9 ppm', 'K__18':'5.9 ppm', 'L__18':'5.9 ppm', 'M__18':'5.9 ppm', 'N__18':'5.9 ppm', 'O__18':'5.9 ppm', 'P__18':'5.9 ppm', 'R__18':'5.9 ppm', 'S__18':'5.9 ppm', 'T__18':'5.9 ppm',                  
                                        'C__19':'5.9 ppm', 'D__19':'5.9 ppm', 'E__19':'5.9 ppm', 'F__19':'5.9 ppm', 'G__19':'5.9 ppm', 'H__19':'5.9 ppm', 'J__19':'5.9 ppm', 'K__19':'5.9 ppm', 'L__19':'5.9 ppm', 'M__19':'5.9 ppm', 'N__19':'5.9 ppm', 'O__19':'5.9 ppm', 'P__19':'5.9 ppm', 'R__19':'5.9 ppm', 'S__19':'5.9 ppm',                                   
    }
  # Sets the boron impurity values in the dummy elements in each autofilled element position
    self.refl_ppm_positions ={
    'A___1':'CP2', 'B___1':'CP2',                        'K___1':'CP2',                       'T___1':'CP2', 'U___1':'CP2',
    'A___2':'CP2',                                       'K___2':'CP2',                                      'U___2':'CP2',
                                                         'K___3':'CP2',                                                    
                                                         'K___4':'CP2',                                                    
                                                         'K___5':'CP2',                                                    
                                                         'K___6':'CP2',                                                    
                                                         'K___7':'CP2',                                                    
                                                         'K___8':'CP2',                                                    

                                                                                                                           

                                                                                                                           
                                                                                                                           
                                                                                                                           
                                                                                                                           
                                                                                                                           
                                                                                                                           
    'A__18':'CP2',                                                                                           'U__18':'CP2',
    'A__19':'CP2', 'B__19':'CP2',                                                             'T__19':'CP2', 'U__19':'CP2',
    }
  #################################################################################################################################################

  def _set_cladding_positions(self):
    """ Sets the specification for TREAT dummy element cladding material positions """
    
  #################################################################################################################################################
  # Sets the cladding types in the dummy elements in each autofilled element position
    self.refl_clad_positions ={
    'A___1':'Al', 'B___1':'Zr',                                                                       'T___1':'Zr', 'U___1':'Al',
    'A___2':'Zr',                                                                                                   'U___2':'Zr',
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
                                                                                                                                 
    'A__18':'Zr',                                                                                                   'U__18':'Zr',
    'A__19':'Al', 'B__19':'Zr',                                                                       'T__19':'Zr', 'U__19':'Al',
    }

  #################################################################################################################################################

  def _set_slot_positions(self):
    """ Sets the specifications for the slotted dummy element positions """
    
  #################################################################################################################################################
  # No dummy slotted elements in this core
    self.slot_height_positions ={
          'K___1':'48 inch',         
          'K___2':'48 inch',         
          'K___3':'48 inch',         
          'K___4':'48 inch',         
          'K___5':'48 inch',         
          'K___6':'48 inch',         
          'K___7':'48 inch',         
          'K___8':'48 inch',         
    }

  #################################################################################################################################################


  def _set_rcca_positions(self):
    """ Sets the specifications for the control rod element positions """
    
  #################################################################################################################################################
    # The keys that are present in these lists are the only positions that can physically accept control rods   

    # True / False whether the position has a control rod 
    self.rcca_positions = {
                                          'D___2': 0 ,                                                                              'R___2': 0 ,
                                                                              'H___3': 1 ,      'M___3': 1 ,
      'B___4': 0 ,                                          'F___4': 1 ,                                          'O___4': 1 ,                                          'T___4': 0 ,
                                          'D___6': 1 ,                        'H___6': 0 ,      'M___6': 0 ,                        'R___6': 1 ,
                        'C___8': 1 ,                        'F___8': 1 ,                                          'O___8': 1 ,                        'S___8': 1 ,
                        'C__12': 1 ,                        'F__12': 1 ,                                          'O__12': 1 ,                        'S__12': 1 ,
                                          'D__14': 1 ,                        'H__14': 0 ,      'M__14': 0 ,                        'R__14': 1 ,
      'B__16': 0 ,                                          'F__16': 1 ,                                          'O__16': 1 ,                                          'T__16': 0 ,
                                                                              'H__17': 1 ,      'M__17': 1 ,
                                          'D__18': 0 ,                                                                              'R__18': 0 ,
    }

    # Which bank we should be drawing from to get the insertion level
    self.rcca_banks = {
                                          'D___2': 'None' ,                                                                         'R___2': 'None' ,
                                                                              'H___3': 'M8_S_NW' , 'M___3': 'M8_S_NE' ,
      'B___4': 'None' ,                                     'F___4': 'M8_S_NW' ,                                     'O___4': 'M8_S_NE' ,                                     'T___4': 'None' ,
                                          'D___6': 'M8_T_NW' ,                   'H___6':  'None' , 'M___6':  'None' ,                   'R___6': 'M8_T_NE' ,
                        'C___8': 'M8_T_NW' ,                   'F___8':  'M8_C_NW' ,                                     'O___8':  'M8_C_NE' ,                   'S___8': 'M8_T_NE' ,
                        'C__12': 'M8_T_SW' ,                   'F__12':  'M8_C_SW' ,                                     'O__12':  'M8_C_SE' ,                   'S__12': 'M8_T_SE' ,
                                          'D__14': 'M8_T_SW' ,                   'H__14':  'None' , 'M__14':  'None' ,                   'R__14': 'M8_T_SE' ,
      'B__16': 'None' ,                                     'F__16': 'M8_S_SW' ,                                     'O__16': 'M8_S_SE' ,                                     'T__16': 'None' ,
                                                                              'H__17': 'M8_S_SW' , 'M__17': 'M8_S_SE' ,
                                          'D__18': 'None' ,                                                                         'R__18': 'None' ,
    }

    # Which type of control rod is in the spot
    # TODO Check the types. Believe the minimum critical core was built early enough to use type I and assume that they used
    #      shutdown type rods, but should check.
    self.rcca_type = {
                                          'D___2': 'None' ,                                                                                                                     'R___2': 'None' ,
                                                                                         'H___3': 'Shutdown Type II' ,            'M___3': 'Shutdown Type II' ,
      'B___4': 'None' ,                                     'F___4': 'Shutdown Type II' ,                                                                      'O___4': 'Shutdown Type II' ,                                                'T___4': 'None' ,
                                          'D___6': 'Transient Type II' ,                              'H___6': 'None' , 'M___6': 'None' ,                              'R___6': 'Transient Type II' ,
                        'C___8': 'Transient Type II' ,                   'F___8': 'Shutdown Type II' ,                                                           'O___8': 'Shutdown Type II' ,                   'S___8': 'Transient Type II' ,
                        'C__12': 'Transient Type II' ,                   'F__12': 'Shutdown Type II' ,                                                           'O__12': 'Shutdown Type II' ,                   'S__12': 'Transient Type II' ,
                                          'D__14': 'Transient Type II' ,                              'H__14': 'None' , 'M__14': 'None' ,                              'R__14': 'Transient Type II' ,
      'B__16': 'None' ,                                     'F__16': 'Shutdown Type II' ,                                                                      'O__16': 'Shutdown Type II' ,                                                'T__16': 'None' ,
                                                                                         'H__17': 'Shutdown Type II' ,            'M__17': 'Shutdown Type II' ,
                                          'D__18': 'None' ,                                                                                                                     'R__18': 'None' ,
    }

  #################################################################################################################################################

  def _make_core_universe(self):
    # Goes through and actually autofills the positions
    """ Creates the TREAT core lattice universe """

    lattice = TemplatedLattice(c.ROOT_LATTICE, name='Core Lattice')
    lattice.setTemplate(self.core_lattice_template)
    lattice.pitch = [c.latticePitch, c.latticePitch]
    lattice.lower_left = [-c.n_lattice_positions * c.latticePitch / 2.0, -c.n_lattice_positions * c.latticePitch / 2.0]
    for pos in self.core_positions:
      # Do the fueled elements first
      if pos in self.fuel_wgt_positions:
        # First set the fuel weight percent and the boron ppm concentration for this position
        wgt = self.fuel_wgt_positions[pos]
        boron = self.fuel_ppm_positions[pos]
        if pos in self.rcca_positions: # This is a position that can accept a control rod. 
          # For user comprehension, I am keeping two separate checks for whether it is physically possible to have a
          # control rod in a given spot, and whether a control rod actually exists there. This is so that if the
          # user makes edits to a benchmark, or uses it as the base when building an arbitrary loading pattern of
          # their own, they do not place the control rod in an invalid position. In the future it may be decided that
          # it is better to remove this redundant check and simply check for the positions that have a control rod.
          if self.rcca_positions[pos]: # We have a control rod here
            bank = self.rcca_banks[pos]
            rod_type = self.rcca_type[pos]
            lattice.setPosition(pos, self.elements.u_rcca[bank,rod_type,wgt,boron])
          else: # We don't have a control rod here
            lattice.setPosition(pos, self.elements.u_fuel_p[wgt,boron])
        else: # Can't have a control rod here
          lattice.setPosition(pos, self.elements.u_fuel_p[wgt,boron])
      # Now do the dummy elements
      if pos in self.refl_ppm_positions:
        boron = self.refl_ppm_positions[pos]
        if pos in self.refl_clad_positions:
          # We have a regular dummy element
          clad = self.refl_clad_positions[pos]
          # We have a position with a dummy element
          if clad == 'Zr':
            lattice.setPosition(pos, self.elements.u_null_zr_p[boron])
          elif clad == 'Al':
            lattice.setPosition(pos, self.elements.u_null_al_p[boron])
        elif pos in self.slot_height_positions:
          # We have an access hole dummy element
          height = self.slot_height_positions[pos]
          lattice.setPosition(pos, self.elements.u_access_dummy_p[height,boron])

    # Half-width access hole (rotated 180 degrees)
    hw_ahole = self.elements.u_hw_ahole['CP2'].translate_rotate(r_vector=[0, 0, 180])
    lattice.setPosition('K___9', hw_ahole)
    # Empty region, devoid of an element
    lattice.setPosition('K__10', self.elements.u_void)
    # Half-width dummy (default rotation is correct)
    hw_dummy = self.elements.u_hw_zr_p['CP2']
    lattice.setPosition('K__11', hw_dummy)

    lattice.finalize()
    
    self.u_coreLattice = lattice

    self.has_experiment = True

    self.r_experiment = -self.vessel.s_boundOuter_N & +self.vessel.s_boundOuter_S & -self.vessel.s_boundOuter_E & \
                        +self.vessel.s_boundOuter_W & -self.vessel.s_univUpperBound & +self.vessel.s_univLowerBound

